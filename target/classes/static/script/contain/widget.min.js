var Melos=function(obj){if(!obj.el){var parentNode=document.currentScript.parentNode;"script"==parentNode.nodeName&&(parentNode=document.currentScript.parentNode),obj.el=document.currentScript.el||parentNode}return Melos.Component.createByType(obj)};!function(window,Melos){"use strict";var TYPES={},COMPS={},ELMAP={};!function($){function type(){return Object.prototype.toString.call(this).slice(8,-1)}for(var types="Array Object String Date RegExp Function Boolean Number Null Undefined".split(" "),i=types.length;i--;)$["is"+types[i]]=function(self){return function(elem){return type.call(elem)===self}}(types[i]);return $}(Melos),Melos.copy=function(obj,deep){if(null===obj||"object"!=typeof obj)return obj;var name,value,target=Melos.isArray(obj)?[]:{};for(name in obj)value=obj[name],value!==obj&&(deep&&(Melos.isArray(value)||Melos.isObject(value))?target[name]=copy(value,deep):target[name]=value);return target},Melos.extend=function(dist,src,override){if(Melos.isFunction(src))dist.prototype=Object.create(src.prototype),dist=dist.prototype;else{var srcCopy=Melos.copy(src,!0);for(var i in srcCopy)dist[i]=src[i]}if(override){var overCopy=Melos.copy(override,!0);for(var i in overCopy)dist[i]=overCopy[i]}return dist},Melos.get=function(key){return key instanceof HTMLElement?ELMAP[key]:COMPS[key]};var Component=function(obj){};Component.createByType=function(obj){var types=[];obj.lazy&&types.push("lazy"),obj.reload&&types.push("reload");for(var cmp,i=0;i<types.length;i++){var type=TYPES[types[i]];if(type){var tmp=new TYPES[types[i]];tmp.create(obj,cmp),cmp=tmp}}return cmp},Melos.extend(Component,Object,{create:function(obj,comp){comp&&Melos.extend(this,comp);var id=obj.id||obj.el.getAttribute("id");obj.id&&(obj.el=document.getElementById(obj.id)),this.el=obj.el,id&&(COMPS[id]=this),ELMAP[this.el]=this}}),Component.register=function(alias,type){TYPES[alias]=type,Melos[type.name]=type},Melos.Component=Component,window.Melos=Melos;var Reloadable=function(){};Melos.extend(Melos,{ajax:function(params){function json(params){params.type=(params.type||"GET").toUpperCase(),params.data=formatParams(params.data);var xhr=null;if(xhr=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObjcet("Microsoft.XMLHTTP"),xhr.onreadystatechange=function(){if(4==xhr.readyState){var status=xhr.status;if(status>=200&&300>status){var response="",type=xhr.getResponseHeader("Content-type");response=-1!==type.indexOf("xml")&&xhr.responseXML?xhr.responseXML:"application/json"===type?JSON.parse(xhr.responseText):xhr.responseText,params.success&&params.success(response)}else params.error&&params.error(status)}},"GET"==params.type){xhr.open(params.type,params.url+"?"+params.data,!0);for(var header in params.headers)xhr.setRequestHeader(header,params[header]);xhr.send(null)}else{xhr.open(params.type,params.url,!0);for(var header in params.headers)xhr.setRequestHeader(header,params[header]);xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),xhr.send(params.data)}}function formatParams(data){var arr=[];for(var name in data)arr.push(encodeURIComponent(name)+"="+encodeURIComponent(data[name]));return arr.push("v="+random()),arr.join("&")}function random(){return Math.floor(1e4*Math.random()+500)}if(params=params||{},params.data=params.data||{},params.method="CONTAIN"){var headers=params.headers||{};headers._melody="melos",params.headers=headers}var json=params.jsonp?jsonp(params):json(params)}}),Melos.extend(Reloadable,Melos.Component,{create:function(obj){Melos.Component.prototype.create.apply(this,arguments),this.url=obj.url},refresh:function(callback){var _this=this,el=this.el;Melos.ajax({url:this.url,type:"CONTAIN",data:{},success:function(res){if(el.innerHTML=res,-1!=res.indexOf("</script>"))for(var myDivScript=el.getElementsByTagName("script"),i=0;i<myDivScript.length;i++){var newScript=document.createElement("SCRIPT");newScript.innerHTML=myDivScript[i].innerHTML,newScript.el=myDivScript[i].parentNode,document.getElementsByTagName("HEAD").item(0).append(newScript)}callback&&callback.call(_this,res)},error:function(error){}})}}),Melos.Component.register("reload",Reloadable);var Lazy=function(){},refresh=function(){for(var i=0;i<Lazy.comps.length;i++){var comp=Lazy.comps[i];if(!comp.loaded&&comp.visible()){comp.load(refresh);break}}};window.addEventListener("load",refresh),window.addEventListener("scroll",refresh),Lazy.comps=[],Melos.extend(Lazy,Melos.Reloadable,{create:function(obj){Melos.Reloadable.prototype.create.apply(this,arguments),this.url=obj.url,Lazy.comps.push(this)},visible:function(){var total=window.innerHeight+window.scrollY;return this.el.offsetTop<total},load:function(callback){this.refresh(callback),this.loaded=!0}}),Melos.Component.register("lazy",Lazy)}(window,Melos);